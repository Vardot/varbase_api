build:
  assessment:
    validate_codebase:
      container_composer:
        - 'config repositories.asset composer https://asset-packagist.org'
        - 'require oomphinc/composer-installers-extender:~1.0'
        - 'require cweagans/composer-patches:~1.0'
        - 'require drupal/drupal-library-installer-plugin:^0.3'
      container_command:
        commands:
          - 'cd ${SOURCE_DIR}'
          - 'sudo -u www-data composer config extra.enable-patching true'
          - 'sudo -u www-data composer config extra.composer-exit-on-patch-failure true'
          - 'sudo -u www-data composer config extra.installer-types.0 "npm-asset"'
          - 'sudo -u www-data composer config extra.installer-types.1 "bower-asset"'
          - 'sudo -u www-data composer config extra.installer-paths.web\/libraries\/\{\$name\} [DOUBLE_QUOTATIONtype:drupal-libraryDOUBLE_QUOTATION,DOUBLE_QUOTATIONtype:bower-assetDOUBLE_QUOTATION,DOUBLE_QUOTATIONtype:npm-assetDOUBLE_QUOTATION]'
          - 'sudo -u www-data composer config extra.installer-paths.web\/libraries\/swagger-ui [DOUBLE_QUOTATIONswagger-ui/swagger-uiDOUBLE_QUOTATION]'
          - 'sudo -u www-data composer config extra.libraries "[{DOUBLE_QUOTATIONnameDOUBLE_QUOTATION: DOUBLE_QUOTATIONswagger-uiDOUBLE_QUOTATION, DOUBLE_QUOTATIONpackageDOUBLE_QUOTATION: DOUBLE_QUOTATIONswagger-ui/swagger-uiDOUBLE_QUOTATION}]"'
          - sed -i 's/DOUBLE_QUOTATION/"/g' composer.json
          - sed -i 's/\"\[\"/["/g' composer.json
          - sed -i 's/\"\]\"/"]/g' composer.json
          - sed -i 's/\"{\"/{"/g' composer.json
          - sed -i 's/\"}\"]\"/"}/g' composer.json
          - sed -i 's/\"\[{\"/[{"/g' composer.json
          - sed -i 's/\"}\]\"/"}]/g' composer.json
          - 'sudo -u www-data composer require swagger-api/swagger-ui:~3.0'
          - 'dir libraries'
      phplint:
      csslint:
        halt-on-fail: false
      eslint:
        halt-on-fail: false
      phpcs:
        sniff-all-files: false
        halt-on-fail: false
    testing:
      run_tests.javascript:
        concurrency: 15
        types: 'PHPUnit-FunctionalJavascript'
        testgroups: '--all'
        suppress-deprecations: false
        halt-on-fail: false
